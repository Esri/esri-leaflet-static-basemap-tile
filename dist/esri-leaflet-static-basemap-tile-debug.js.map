{"version":3,"file":"esri-leaflet-static-basemap-tile-debug.js","sources":["../src/Util.js","../src/StaticBasemapTileLayer.js","../src/EsriLeafletStaticBasemapTile.js"],"sourcesContent":["/* Copyright 2024 Esri\r\n *\r\n * Licensed under the Apache License Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { request } from 'esri-leaflet';\r\n\r\n// URL of the static basemap tiles service (currently in Beta)\r\nconst baseUrl = 'https://static-map-tiles-api.arcgis.com/arcgis/rest/services/static-basemap-tiles-service/';\r\n\r\n/**\r\n * Utility to establish a URL for the static basemap tiles API\r\n *\r\n * @param {string} style\r\n * @param {string} accessToken\r\n * @param {Object} [options] Optional list of parameters: language.\r\n * @returns {string} the URL\r\n */\r\nexport function getStaticBasemapTilesUrl (style, accessToken, options) {\r\n  if (!accessToken) throw new Error('An access token is required to access the static basemap tiles service.');\r\n\r\n  // Tile endpoint in {z}/{y}/{x} format\r\n  let url = baseUrl + style + '/static/tile/{z}/{y}/{x}?token=' + accessToken;\r\n\r\n  // Handle additional service parameters\r\n  if (options.language) {\r\n    url += '&language=' + options.language;\r\n  }\r\n\r\n  return url;\r\n}\r\n\r\n/**\r\n * Utility that retrieves attribution data for a given style\r\n * @param {string} style\r\n * @param {string} accessToken\r\n * @returns The attribution data from the '/static' endpoint of a style enumeration\r\n */\r\nexport async function fetchAttribution (style, accessToken) {\r\n  const attributionUrl = baseUrl + style + '/static';\r\n  return new Promise((resolve, reject) => {\r\n    request(attributionUrl, { token: accessToken }, (error, resp) => {\r\n      if (error) reject(error);\r\n      resolve(resp.copyrightText);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Utility to make a /self request to the static basemap tiles service\r\n * @param {string} accessToken\r\n * @returns {Object} A list of all supported basemap styles, including thumbnail URLs and supported language codes.\r\n */\r\nexport async function getSelf (accessToken) {\r\n  if (!accessToken) throw new Error('An access token is required to access the static basemap tiles service.');\r\n\r\n  const selfUrl = baseUrl + 'beta/self';\r\n  return new Promise((resolve, reject) => {\r\n    request(selfUrl, { token: accessToken }, (error, resp) => {\r\n      if (error) reject(error);\r\n      resolve(resp);\r\n    });\r\n  });\r\n}\r\n\r\nexport var EsriUtil = {\r\n  getSelf: getSelf\r\n};\r\n\r\nexport default EsriUtil;\r\n","/* Copyright 2024 Esri\r\n *\r\n * Licensed under the Apache License Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { TileLayer, setOptions } from 'leaflet';\r\nimport { getStaticBasemapTilesUrl, fetchAttribution } from './Util';\r\nimport { Util } from 'esri-leaflet';\r\n\r\nexport var StaticBasemapTileLayer = TileLayer.extend({\r\n  initialize: function (style, options) {\r\n    if (options) {\r\n      setOptions(this, options);\r\n    }\r\n    // support outdated casing apiKey of apikey\r\n    if (this.options.apiKey) {\r\n      this.options.apikey = this.options.apiKey;\r\n    }\r\n    // propagate apikey to token and vice versa\r\n    if (this.options.apikey) {\r\n      this.options.token = this.options.apikey;\r\n    } else if (this.options.token) {\r\n      this.options.apikey = this.options.token;\r\n    }\r\n    // if no access token provided\r\n    if (!this.options.token) {\r\n      throw new Error(\r\n        'An ArcGIS access token is required for static basemap tiles. To learn more, go to https://developers.arcgis.com/documentation/security-and-authentication/'\r\n      );\r\n    }\r\n    // If no style passed in\r\n    if (!style) {\r\n      throw new Error(\r\n        'A valid style enum is required for staticBasemapTileLayer (e.g. \\'beta/arcgis/streets\\').'\r\n      );\r\n    }\r\n    if (!style.includes('beta')) {\r\n      throw new Error(\r\n        'The basemap styles service is currently in beta. All style enums must begin with \\'beta\\' (e.g. \\'beta/arcgis/outdoor\\').'\r\n      );\r\n    }\r\n    // Set layer pane\r\n    if (options.pane) {\r\n      this.options.pane = options.pane;\r\n    } else if (style.includes('/labels')) {\r\n      this.options.pane = 'esri-labels';\r\n    }\r\n\r\n    this.options.zoomOffset = -1;\r\n    this.options.tileSize = 512;\r\n\r\n    // Save style into \"this.options\" for use elsewhere in the module.\r\n    this.options.style = style;\r\n    this.serviceUrl = getStaticBasemapTilesUrl(style, this.options.token, this.options);\r\n\r\n    TileLayer.prototype.initialize.call(this, this.serviceUrl, this.options);\r\n  },\r\n  onAdd: function (map) {\r\n    // Setup Esri attribution\r\n    this._setupAttribution();\r\n\r\n    this._initPane();\r\n\r\n    TileLayer.prototype.onAdd.call(this, map);\r\n  },\r\n  onRemove: function (map) {\r\n    this._removeAttribution();\r\n    TileLayer.prototype.onRemove.call(this, map);\r\n  },\r\n  _setupAttribution: function () {\r\n    if (!this._map) return;\r\n    Util.setEsriAttribution(this._map);\r\n    fetchAttribution(this.options.style, this.options.token).then(attribution => {\r\n      // Add attribution directly to map\r\n      this._map.attributionControl.addAttribution(attribution);\r\n    });\r\n  },\r\n  _removeAttribution: function () {\r\n    if (Util.removeEsriAttribution) Util.removeEsriAttribution(this._map);\r\n  },\r\n  _initPane: function () {\r\n    if (this._map.getPane(this.options.pane)) return;\r\n\r\n    const pane = this._map.createPane(this.options.pane);\r\n    pane.style.pointerEvents = 'none';\r\n\r\n    // Default value for tileLayer\r\n    let zIndex = 200;\r\n    if (this.options.pane === 'esri-labels') zIndex = 300;\r\n    pane.style.zIndex = zIndex;\r\n  }\r\n});\r\n\r\nexport function staticBasemapTileLayer (key, options) {\r\n  return new StaticBasemapTileLayer(key, options);\r\n}\r\n","/* Copyright 2024 Esri\r\n *\r\n * Licensed under the Apache License Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport packageInfo from '../package.json';\r\nconst version = packageInfo.version;\r\nexport { version as VERSION };\r\n\r\nexport { StaticBasemapTileLayer, staticBasemapTileLayer } from './StaticBasemapTileLayer';\r\nexport { EsriUtil as Util } from './Util';\r\n"],"names":["request","TileLayer","setOptions","Util"],"mappings":"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"}