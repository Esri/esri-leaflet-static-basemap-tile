{"version":3,"file":"esri-leaflet-static-basemap-tile.js","sources":["../src/Util.js","../src/StaticBasemapTileLayer.js","../src/EsriLeafletStaticBasemapTile.js"],"sourcesContent":["/* Copyright 2024 Esri\r\n *\r\n * Licensed under the Apache License Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { request } from 'esri-leaflet';\r\n\r\n// URL of the static basemap tiles service (currently in Beta)\r\nconst baseUrl = 'https://static-map-tiles-api.arcgis.com/arcgis/rest/services/static-basemap-tiles-service/';\r\n\r\n/**\r\n * Utility to establish a URL for the static basemap tiles API\r\n *\r\n * @param {string} style\r\n * @param {string} accessToken\r\n * @param {Object} [options] Optional list of parameters: language.\r\n * @returns {string} the URL\r\n */\r\nexport function getStaticBasemapTilesUrl (style, accessToken, options) {\r\n  if (!accessToken) throw new Error('An access token is required to access the static basemap tiles service.');\r\n\r\n  // Tile endpoint in {z}/{y}/{x} format\r\n  let url = baseUrl + style + '/static/tile/{z}/{y}/{x}?token=' + accessToken;\r\n\r\n  // Handle additional service parameters\r\n  if (options.language) {\r\n    url += '&language=' + options.language;\r\n  }\r\n\r\n  return url;\r\n}\r\n\r\n/**\r\n * Utility that retrieves attribution data for a given style\r\n * @param {string} style\r\n * @param {string} accessToken\r\n * @returns The attribution data from the '/static' endpoint of a style enumeration\r\n */\r\nexport async function fetchAttribution (style, accessToken) {\r\n  const attributionUrl = baseUrl + style + '/static';\r\n  return new Promise((resolve, reject) => {\r\n    request(attributionUrl, { token: accessToken }, (error, resp) => {\r\n      if (error) reject(error);\r\n      resolve(resp.copyrightText);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Utility to make a /self request to the static basemap tiles service\r\n * @param {string} accessToken\r\n * @returns {Object} A list of all supported basemap styles, including thumbnail URLs and supported language codes.\r\n */\r\nexport async function getSelf (accessToken) {\r\n  if (!accessToken) throw new Error('An access token is required to access the static basemap tiles service.');\r\n\r\n  const selfUrl = baseUrl + 'beta/self';\r\n  return new Promise((resolve, reject) => {\r\n    request(selfUrl, { token: accessToken }, (error, resp) => {\r\n      if (error) reject(error);\r\n      resolve(resp);\r\n    });\r\n  });\r\n}\r\n\r\nexport var EsriUtil = {\r\n  getSelf: getSelf\r\n};\r\n\r\nexport default EsriUtil;\r\n","/* Copyright 2024 Esri\r\n *\r\n * Licensed under the Apache License Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { TileLayer, setOptions } from 'leaflet';\r\nimport { getStaticBasemapTilesUrl, fetchAttribution } from './Util';\r\nimport { Util } from 'esri-leaflet';\r\n\r\nexport var StaticBasemapTileLayer = TileLayer.extend({\r\n  initialize: function (style, options) {\r\n    if (options) {\r\n      setOptions(this, options);\r\n    }\r\n    // support outdated casing apiKey of apikey\r\n    if (this.options.apiKey) {\r\n      this.options.apikey = this.options.apiKey;\r\n    }\r\n    // propagate apikey to token and vice versa\r\n    if (this.options.apikey) {\r\n      this.options.token = this.options.apikey;\r\n    } else if (this.options.token) {\r\n      this.options.apikey = this.options.token;\r\n    }\r\n    // if no access token provided\r\n    if (!this.options.token) {\r\n      throw new Error(\r\n        'An ArcGIS access token is required for static basemap tiles. To learn more, go to https://developers.arcgis.com/documentation/security-and-authentication/'\r\n      );\r\n    }\r\n    // If no style passed in\r\n    if (!style) {\r\n      throw new Error(\r\n        'A valid style enum is required for staticBasemapTileLayer (e.g. \\'beta/arcgis/streets\\').'\r\n      );\r\n    }\r\n    if (!style.includes('beta')) {\r\n      throw new Error(\r\n        'The basemap styles service is currently in beta. All style enums must begin with \\'beta\\' (e.g. \\'beta/arcgis/outdoor\\').'\r\n      );\r\n    }\r\n    // Set layer pane\r\n    if (options.pane) {\r\n      this.options.pane = options.pane;\r\n    } else if (style.includes('/labels')) {\r\n      this.options.pane = 'esri-labels';\r\n    }\r\n\r\n    this.options.zoomOffset = -1;\r\n    this.options.tileSize = 512;\r\n\r\n    // Save style into \"this.options\" for use elsewhere in the module.\r\n    this.options.style = style;\r\n    this.serviceUrl = getStaticBasemapTilesUrl(style, this.options.token, this.options);\r\n\r\n    TileLayer.prototype.initialize.call(this, this.serviceUrl, this.options);\r\n  },\r\n  onAdd: function (map) {\r\n    // Setup Esri attribution\r\n    this._setupAttribution();\r\n\r\n    this._initPane();\r\n\r\n    TileLayer.prototype.onAdd.call(this, map);\r\n  },\r\n  onRemove: function (map) {\r\n    this._removeAttribution();\r\n    TileLayer.prototype.onRemove.call(this, map);\r\n  },\r\n  _setupAttribution: function () {\r\n    if (!this._map) return;\r\n    Util.setEsriAttribution(this._map);\r\n    fetchAttribution(this.options.style, this.options.token).then(attribution => {\r\n      // Add attribution directly to map\r\n      this._map.attributionControl.addAttribution(attribution);\r\n    });\r\n  },\r\n  _removeAttribution: function () {\r\n    if (Util.removeEsriAttribution) Util.removeEsriAttribution(this._map);\r\n  },\r\n  _initPane: function () {\r\n    if (this._map.getPane(this.options.pane)) return;\r\n\r\n    const pane = this._map.createPane(this.options.pane);\r\n    pane.style.pointerEvents = 'none';\r\n\r\n    // Default value for tileLayer\r\n    let zIndex = 200;\r\n    if (this.options.pane === 'esri-labels') zIndex = 300;\r\n    pane.style.zIndex = zIndex;\r\n  }\r\n});\r\n\r\nexport function staticBasemapTileLayer (key, options) {\r\n  return new StaticBasemapTileLayer(key, options);\r\n}\r\n","/* Copyright 2024 Esri\r\n *\r\n * Licensed under the Apache License Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport packageInfo from '../package.json';\r\nconst version = packageInfo.version;\r\nexport { version as VERSION };\r\n\r\nexport { StaticBasemapTileLayer, staticBasemapTileLayer } from './StaticBasemapTileLayer';\r\nexport { EsriUtil as Util } from './Util';\r\n"],"names":["baseUrl","EsriUtil","getSelf","async","accessToken","Error","selfUrl","Promise","resolve","reject","request","token","error","resp","StaticBasemapTileLayer","TileLayer","extend","initialize","style","options","setOptions","this","apiKey","apikey","includes","pane","zoomOffset","tileSize","serviceUrl","url","language","getStaticBasemapTilesUrl","prototype","call","onAdd","map","_setupAttribution","_initPane","onRemove","_removeAttribution","_map","Util","setEsriAttribution","attributionUrl","copyrightText","fetchAttribution","then","attribution","attributionControl","addAttribution","removeEsriAttribution","getPane","createPane","pointerEvents","zIndex","version","packageInfo","key"],"mappings":";;;mYAiBA,MAAMA,EAAU,6FAyDN,IAACC,EAAW,CACpBC,QAbKC,eAAwBC,GAC7B,IAAKA,EAAa,MAAM,IAAIC,MAAM,2EAElC,MAAMC,EAAUN,EAAU,YAC1B,OAAO,IAAIO,SAAQ,CAACC,EAASC,KAC3BC,EAAOA,QAACJ,EAAS,CAAEK,MAAOP,IAAe,CAACQ,EAAOC,KAC3CD,GAAOH,EAAOG,GAClBJ,EAAQK,EAAK,GACb,GAEN,GCtDWC,EAAyBC,EAASA,UAACC,OAAO,CACnDC,WAAY,SAAUC,EAAOC,GAe3B,GAdIA,GACFC,aAAWC,KAAMF,GAGfE,KAAKF,QAAQG,SACfD,KAAKF,QAAQI,OAASF,KAAKF,QAAQG,QAGjCD,KAAKF,QAAQI,OACfF,KAAKF,QAAQR,MAAQU,KAAKF,QAAQI,OACzBF,KAAKF,QAAQR,QACtBU,KAAKF,QAAQI,OAASF,KAAKF,QAAQR,QAGhCU,KAAKF,QAAQR,MAChB,MAAM,IAAIN,MACR,8JAIJ,IAAKa,EACH,MAAM,IAAIb,MACR,2FAGJ,IAAKa,EAAMM,SAAS,QAClB,MAAM,IAAInB,MACR,yHAIAc,EAAQM,KACVJ,KAAKF,QAAQM,KAAON,EAAQM,KACnBP,EAAMM,SAAS,aACxBH,KAAKF,QAAQM,KAAO,eAGtBJ,KAAKF,QAAQO,YAAc,EAC3BL,KAAKF,QAAQQ,SAAW,IAGxBN,KAAKF,QAAQD,MAAQA,EACrBG,KAAKO,WDnCF,SAAmCV,EAAOd,EAAae,GAC5D,IAAKf,EAAa,MAAM,IAAIC,MAAM,2EAGlC,IAAIwB,EAAM7B,EAAUkB,EAAQ,kCAAoCd,EAOhE,OAJIe,EAAQW,WACVD,GAAO,aAAeV,EAAQW,UAGzBD,CACT,CCuBsBE,CAAyBb,EAAOG,KAAKF,QAAQR,MAAOU,KAAKF,SAE3EJ,YAAUiB,UAAUf,WAAWgB,KAAKZ,KAAMA,KAAKO,WAAYP,KAAKF,QACjE,EACDe,MAAO,SAAUC,GAEfd,KAAKe,oBAELf,KAAKgB,YAELtB,EAASA,UAACiB,UAAUE,MAAMD,KAAKZ,KAAMc,EACtC,EACDG,SAAU,SAAUH,GAClBd,KAAKkB,qBACLxB,EAASA,UAACiB,UAAUM,SAASL,KAAKZ,KAAMc,EACzC,EACDC,kBAAmB,WACZf,KAAKmB,OACVC,EAAAA,KAAKC,mBAAmBrB,KAAKmB,MDjC1BrC,eAAiCe,EAAOd,GAC7C,MAAMuC,EAAiB3C,EAAUkB,EAAQ,UACzC,OAAO,IAAIX,SAAQ,CAACC,EAASC,KAC3BC,EAAOA,QAACiC,EAAgB,CAAEhC,MAAOP,IAAe,CAACQ,EAAOC,KAClDD,GAAOH,EAAOG,GAClBJ,EAAQK,EAAK+B,cAAc,GAC3B,GAEN,CC0BIC,CAAiBxB,KAAKF,QAAQD,MAAOG,KAAKF,QAAQR,OAAOmC,MAAKC,IAE5D1B,KAAKmB,KAAKQ,mBAAmBC,eAAeF,EAAY,IAE3D,EACDR,mBAAoB,WACdE,EAAAA,KAAKS,uBAAuBT,EAAAA,KAAKS,sBAAsB7B,KAAKmB,KACjE,EACDH,UAAW,WACT,GAAIhB,KAAKmB,KAAKW,QAAQ9B,KAAKF,QAAQM,MAAO,OAE1C,MAAMA,EAAOJ,KAAKmB,KAAKY,WAAW/B,KAAKF,QAAQM,MAC/CA,EAAKP,MAAMmC,cAAgB,OAG3B,IAAIC,EAAS,IACa,gBAAtBjC,KAAKF,QAAQM,OAAwB6B,EAAS,KAClD7B,EAAKP,MAAMoC,OAASA,CACrB,ICpFG,MAAAC,EAAUC,2EDuFT,SAAiCC,EAAKtC,GAC3C,OAAO,IAAIL,EAAuB2C,EAAKtC,EACzC"}